{"ast":null,"code":"import { Chart, LineController, LineElement, PointElement, LinearScale, Title, CategoryScale } from 'chart.js';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../shared/services/analytics.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../shared/components/loader/loader.component\";\nconst _c0 = [\"gain\"];\nconst _c1 = [\"order\"];\n\nfunction AnalyticsPageComponent_app_loader_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loader\");\n  }\n}\n\nexport let AnalyticsPageComponent = /*#__PURE__*/(() => {\n  class AnalyticsPageComponent {\n    constructor(service) {\n      this.service = service;\n      this.pending = true;\n      this.lineChartType = 'line';\n      Chart.register(LineController, LineElement, PointElement, LinearScale, Title, CategoryScale);\n    }\n\n    ngAfterViewInit() {\n      const gainConfig = {\n        label: 'Выручка',\n        color: 'rgba(255, 99, 132)'\n      };\n      const orderConfig = {\n        label: 'Заказы',\n        color: 'rgba(54, 162, 235)'\n      };\n      this.aSub = this.service.getAnalytics().subscribe(data => {\n        this.average = data.average;\n        gainConfig.labels = data.chart.map(item => item.label);\n        gainConfig.data = data.chart.map(item => item.gain);\n        gainConfig.type = this.lineChartType;\n        orderConfig.labels = data.chart.map(item => item.label);\n        orderConfig.data = data.chart.map(item => item.order);\n        orderConfig.type = this.lineChartType;\n        const gainCtx = this.gainRef.nativeElement.getContext('2d');\n        const orderCtx = this.orderRef.nativeElement.getContext('2d');\n        gainCtx.canvas.height = '300px';\n        orderCtx.canvas.height = '300px';\n        new Chart(gainCtx, createChartConfig(gainConfig));\n        new Chart(orderCtx, createChartConfig(orderConfig));\n        this.pending = false;\n      });\n    }\n\n    ngOnDestroy() {\n      if (this.aSub) {\n        this.aSub.unsubscribe();\n      }\n    }\n\n  }\n\n  AnalyticsPageComponent.ɵfac = function AnalyticsPageComponent_Factory(t) {\n    return new (t || AnalyticsPageComponent)(i0.ɵɵdirectiveInject(i1.AnalyticsService));\n  };\n\n  AnalyticsPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AnalyticsPageComponent,\n    selectors: [[\"app-analytics-page\"]],\n    viewQuery: function AnalyticsPageComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n        i0.ɵɵviewQuery(_c1, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.gainRef = _t.first);\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.orderRef = _t.first);\n      }\n    },\n    decls: 20,\n    vars: 4,\n    consts: [[1, \"page-title\"], [1, \"average-price\"], [1, \"analytics-block\", \"pb3\"], [\"gain\", \"\"], [1, \"analytics-block\"], [\"order\", \"\"], [4, \"ngIf\"]],\n    template: function AnalyticsPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"h4\");\n        i0.ɵɵtext(2, \"\\u0410\\u043D\\u0430\\u043B\\u0438\\u0442\\u0438\\u043A\\u0430\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"div\");\n        i0.ɵɵelementStart(4, \"div\", 1);\n        i0.ɵɵelementStart(5, \"p\");\n        i0.ɵɵtext(6, \"\\u0421\\u0440\\u0435\\u0434\\u043D\\u0438\\u0439 \\u0447\\u0435\\u043A \");\n        i0.ɵɵelementStart(7, \"strong\");\n        i0.ɵɵtext(8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"div\", 2);\n        i0.ɵɵelementStart(10, \"h5\");\n        i0.ɵɵtext(11, \"\\u0412\\u044B\\u0440\\u0443\\u0447\\u043A\\u0430\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(12, \"canvas\", null, 3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"div\", 4);\n        i0.ɵɵelementStart(15, \"h5\");\n        i0.ɵɵtext(16, \"\\u0417\\u0430\\u043A\\u0430\\u0437\\u044B\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(17, \"canvas\", null, 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(19, AnalyticsPageComponent_app_loader_19_Template, 1, 0, \"app-loader\", 6);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵstyleProp(\"display\", ctx.pending ? \"none\" : \"block\");\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\"\", ctx.average, \" \\u0440.\");\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngIf\", ctx.pending);\n      }\n    },\n    directives: [i2.NgIf, i3.LoaderComponent],\n    styles: [\"\"]\n  });\n  return AnalyticsPageComponent;\n})();\n\nfunction createChartConfig({\n  type,\n  labels,\n  data,\n  label,\n  color\n}) {\n  return {\n    type,\n    data: {\n      labels,\n      datasets: [{\n        label,\n        data,\n        borderColor: color,\n        cubicInterpolationMode: 'monotone',\n        stepped: false,\n        fill: false\n      }]\n    }\n  };\n}","map":null,"metadata":{},"sourceType":"module"}