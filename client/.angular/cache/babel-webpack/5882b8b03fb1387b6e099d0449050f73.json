{"ast":null,"code":"import { MaterialService } from '../shared/classes/material.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../shared/services/orders.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"./history-filter/history-filter.component\";\nimport * as i4 from \"./history-list/history-list.component\";\nimport * as i5 from \"../shared/components/loader/loader.component\";\nconst _c0 = [\"tooltip\"];\n\nfunction HistoryPageComponent_app_history_filter_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"app-history-filter\", 7);\n    i0.ɵɵlistener(\"onFilter\", function HistoryPageComponent_app_history_filter_7_Template_app_history_filter_onFilter_0_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.applyFilter($event);\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HistoryPageComponent_div_8_div_1_div_2_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function HistoryPageComponent_div_8_div_1_div_2_button_1_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext(4);\n      return ctx_r14.loadMore();\n    });\n    i0.ɵɵtext(1, \" \\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u0435\\u0449\\u0435 \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HistoryPageComponent_div_8_div_1_div_2_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loader\");\n  }\n}\n\nfunction HistoryPageComponent_div_8_div_1_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtemplate(1, HistoryPageComponent_div_8_div_1_div_2_button_1_Template, 2, 0, \"button\", 12);\n    i0.ɵɵtemplate(2, HistoryPageComponent_div_8_div_1_div_2_ng_template_2_Template, 1, 0, \"ng-template\", null, 13, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const _r12 = i0.ɵɵreference(3);\n\n    const ctx_r10 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r10.loading)(\"ngIfElse\", _r12);\n  }\n}\n\nfunction HistoryPageComponent_div_8_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"app-history-list\", 9);\n    i0.ɵɵtemplate(2, HistoryPageComponent_div_8_div_1_div_2_Template, 4, 2, \"div\", 10);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"orders\", ctx_r7.orders);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r7.noMoreOrders);\n  }\n}\n\nfunction HistoryPageComponent_div_8_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵtext(1, \"\\u0417\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432 \\u043F\\u043E\\u043A\\u0430 \\u043D\\u0435\\u0442\\u044E\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HistoryPageComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, HistoryPageComponent_div_8_div_1_Template, 3, 2, \"div\", 5);\n    i0.ɵɵtemplate(2, HistoryPageComponent_div_8_ng_template_2_Template, 2, 0, \"ng-template\", null, 8, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const _r8 = i0.ɵɵreference(3);\n\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.orders.length > 0)(\"ngIfElse\", _r8);\n  }\n}\n\nfunction HistoryPageComponent_ng_template_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-loader\");\n  }\n}\n\nconst _c1 = function (a0, a1) {\n  return {\n    \"active\": a0,\n    \"red\": a1\n  };\n};\n\nconst STEP = 2;\nexport let HistoryPageComponent = /*#__PURE__*/(() => {\n  class HistoryPageComponent {\n    constructor(ordersService) {\n      this.ordersService = ordersService;\n      this.isFilterVisible = false;\n      this.orders = [];\n      this.filter = {};\n      this.offset = 0;\n      this.limit = STEP;\n      this.loading = false;\n      this.reloading = false;\n      this.noMoreOrders = false;\n    }\n\n    ngOnInit() {\n      this.reloading = true;\n      this.fetch();\n    }\n\n    fetch() {\n      const params = Object.assign({}, this.filter, {\n        offset: this.offset,\n        limit: this.limit\n      });\n      this.oSub = this.ordersService.fetch(params).subscribe(orders => {\n        this.orders = this.orders.concat(orders);\n        this.noMoreOrders = orders.length < STEP;\n        this.loading = false;\n        this.reloading = false;\n      });\n    }\n\n    loadMore() {\n      this.offset += STEP;\n      this.loading = true;\n      this.fetch();\n    }\n\n    ngOnDestroy() {\n      this.tooltip.destroy();\n      this.oSub.unsubscribe();\n    }\n\n    applyFilter(filter) {\n      this.orders = [];\n      this.offset = 0;\n      this.reloading = true;\n      this.filter = filter;\n      this.fetch();\n    }\n\n    ngAfterViewInit() {\n      this.tooltip = MaterialService.initTooltip(this.tooltipRef);\n    }\n\n    isFiltered() {\n      return Object.keys(this.filter).length > 0;\n    }\n\n  }\n\n  HistoryPageComponent.ɵfac = function HistoryPageComponent_Factory(t) {\n    return new (t || HistoryPageComponent)(i0.ɵɵdirectiveInject(i1.OrdersService));\n  };\n\n  HistoryPageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: HistoryPageComponent,\n    selectors: [[\"app-history-page\"]],\n    viewQuery: function HistoryPageComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.tooltipRef = _t.first);\n      }\n    },\n    decls: 11,\n    vars: 7,\n    consts: [[1, \"page-title\"], [\"data-tooltip\", \"\\u041E\\u0442\\u043A\\u0440\\u044B\\u0442\\u044C \\u0444\\u0438\\u043B\\u044C\\u0442\\u0440\", \"data-position\", \"left\", 1, \"btn\", \"btn-small\", 3, \"ngClass\", \"click\"], [\"tooltip\", \"\"], [1, \"material-icons\"], [3, \"onFilter\", 4, \"ngIf\"], [4, \"ngIf\", \"ngIfElse\"], [\"reloadingBlock\", \"\"], [3, \"onFilter\"], [\"empty\", \"\"], [3, \"orders\"], [\"class\", \"center mb2\", 4, \"ngIf\"], [1, \"center\", \"mb2\"], [\"class\", \"btn waves-effect grey darken-1 btn-small\", 3, \"click\", 4, \"ngIf\", \"ngIfElse\"], [\"loader\", \"\"], [1, \"btn\", \"waves-effect\", \"grey\", \"darken-1\", \"btn-small\", 3, \"click\"], [1, \"center\"]],\n    template: function HistoryPageComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"h4\");\n        i0.ɵɵtext(2, \"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"button\", 1, 2);\n        i0.ɵɵlistener(\"click\", function HistoryPageComponent_Template_button_click_3_listener() {\n          return ctx.isFilterVisible = !ctx.isFilterVisible;\n        });\n        i0.ɵɵelementStart(5, \"i\", 3);\n        i0.ɵɵtext(6, \"filter_list\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(7, HistoryPageComponent_app_history_filter_7_Template, 1, 0, \"app-history-filter\", 4);\n        i0.ɵɵtemplate(8, HistoryPageComponent_div_8_Template, 4, 2, \"div\", 5);\n        i0.ɵɵtemplate(9, HistoryPageComponent_ng_template_9_Template, 1, 0, \"ng-template\", null, 6, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        const _r3 = i0.ɵɵreference(10);\n\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(4, _c1, ctx.isFilterVisible, ctx.isFiltered()));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.isFilterVisible);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.reloading)(\"ngIfElse\", _r3);\n      }\n    },\n    directives: [i2.NgClass, i2.NgIf, i3.HistoryFilterComponent, i4.HistoryListComponent, i5.LoaderComponent],\n    styles: [\"\"]\n  });\n  return HistoryPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}